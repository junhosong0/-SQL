# 인덱스의 내부 작동
인덱스 생성 및 사용은 어렵지 않음. 하지만 인덱스의 작동 과정을 이해하고 사용해야 함.
클러스터형 인덱스와 보조 인덱스는 모두 내부적으로 균형 트리로 만들어 짐. **균형트리 (balanced tree)**는 '자료 구조'에 나오는 범용적으로 사용되는 데이터의 구조임.

나무를 거꾸로 표현한 자료 구조로, 트리에서 제일 상단의 뿌리를 루트, 줄기를 중간, 끝이 달린 잎을 리프라고 부름

![20240301_154411](https://github.com/junhosong0/MySQL/assets/117610783/50a95f02-fb62-4a59-8310-a2c988128538)


## 인덱스의 내부 작동 원리

### 균형 트리의 개념
균형 트리 구조에서 데이터가 저장되는 공간을 **노드node**라고 함. 아래 그림은 2단계까지 표현되었지만 데이터 많아지면 3단계나 그 이상이 될 수 있음.
중요한건 처음 노드는 루트 노드, 마지막 노드는 리프 노드 그 중안 노드들은 모두 줄기 노드임.

![20240301_154512](https://github.com/junhosong0/MySQL/assets/117610783/9a96a0fa-7183-4997-b60e-13266cb1b567)


노드라는 용어는 개념적인 설명이고 MySQL에서는 동일한 개념을 **페이지page**라고 부름


**일반적으로 인덱스가 없는 상태에서 SELECT할 경우**
- 전체 테이블 검색(Full Table Sccan): 한건의 데이터를 찾기 위해서 처음부터 하나하나 전부 다 검색해야 함
- 아래 예시에서 MMM을 찾기 위해 3개의 페이지를 검색해야 함.

![20240302_130614](https://github.com/junhosong0/MySQL/assets/117610783/566a7dcc-e677-42f4-b712-4c0a7a03b8e5)


**인덱스가 있는 상태에서 SELECT할 경우**
- 2개의 페이지만 검색하면 된다. 데이터의 크기가 커질수록 효율이 점점 더 커짐  

![20240302_131449](https://github.com/junhosong0/MySQL/assets/117610783/c2d0c648-8a53-4bec-a08f-7bce33b70c78)



### 균형 트리의 페이지 분할
- 인덱스는 균형 트리로 구성되어 있음. 인덱스를 만들면 SELECT의 속도를 향상시킬 수 있음.
- 하지만 인덱스 구성시 데이터 변경 작업(INSERT, UPDATE, DELETE) 시 성능이 나빠짐. 특히 INSERT 작업이 일어날 때 더 느리게 입력. 이유는 **페이지 분할**이라는 작업이 발생하기 때문
- 페이지 분할: 새로운 페이지를 준비해서 데이터를 나누는 작업. 페이지 분할이 일어나면 느려지고 자주 일어나면 성능에 큰 영향을 줌


**인덱스가 있는 상태에서 INSERT할 경우**



